---
title: "HW3"
author: "juan"
date: '2017-09-27'
output: github_document
---

```{r}
library(gapminder)
suppressMessages(library(tidyverse))
```

### Welcome to HW#3 
+ Instruction: Get the maximum and minimum of GDP per capita for all continents.

##### In the table, we can see the MEAN, MAX and MIN gdps per capita in all the continents. 
```{r}
gdps<- gapminder %>%
  group_by(continent) %>% 
  select(gdpPercap) %>% 
summarise(mean_gdp= mean(gdpPercap),max_gdp= max(gdpPercap), min_gdp= min(gdpPercap) ) 
gdps %>% 
  knitr::kable(format = "markdown", padding=2, caption= "MEAN, MAX and MIN gdps per capita")
```


##### There is a lot of contrast in Asia's gdps. It has extreme numbers, the hights and the second lowest gdps in all time.
```{r figure3.1}
gapminder %>%
  group_by(continent) %>% 
  ggplot(aes(year, gdpPercap, color= continent))+
  geom_smooth(method="loess", span=0.5)+ geom_point()
```


+ Instruction: Compute a trimmed mean of life expectancy for different years. Or a weighted mean, weighting by population. Just try something other than the plain vanilla mean.

##### Here I calculated both the **trimmed** and **weighted** mean of the life expectancy per year. 

```{r figure3.2}
means<- gapminder %>%
  group_by(year) %>%
  summarize(tm_lifeExp = mean(lifeExp, trim= 0.2), wmean= weighted.mean(lifeExp, pop)) 
means %>% 
  knitr::kable(format = "markdown", padding=2, caption= "Trimmed and weighted means")
gapminder %>%
  group_by(continent) %>% 
  ggplot(aes(year,gdpPercap)) + 
  geom_boxplot(aes(color= continent)) + 
  scale_y_log10() 
```

+ Instruction: How is life expectancy changing over time on different continents?

##### Life expectancy is increasing in most countries. Understandably, countries with low GDP per capita and countries facing internal conflicts (with war or diseases) seem slower growth and setbacks.

```{r figure3.3}
ggplot(gapminder, aes(lifeExp, year , size= gdpPercap, color= continent)) +
    facet_grid(~ continent) +
    geom_point(alpha= 0.3)
```


+ Instruction: Report the absolute and/or relative abundance of countries with low life expectancy over time by continent: Compute some measure of worldwide life expectancy â€“ you decide 

 The benchmark for the analysis is the mean life expectancy (59.47444). I will devide the results in **high** life expectancy if it is higher than the mean or **low** if otherwise.

```{r}
mean(gapminder$lifeExp)
gapminder %>%
  arrange(year, lifeExp) %>% 
  mutate(l_ex=ifelse(lifeExp< mean(lifeExp), "low", "high")) 

```

```{r figure3.4}
gapminder %>%
  arrange(year, lifeExp) %>% 
  mutate(l_ex=ifelse(lifeExp<= mean(lifeExp), "low", "high")) %>% 
  ggplot(aes( pop, year, color=lifeExp)) +
    facet_grid(l_ex ~ continent) +
    geom_point(alpha= 0.5)+ 
  geom_smooth(method="loess", span=1)
```


+ Instruction:Find countries with interesting stories. Open-ended and, therefore, hard. Promising but unsuccessful attempts are encouraged.

+ Countries with painfully low life expectancy due to various factors such as **war**, **diseases** or **scarcity** of resources. The crisis in Rwanda brought the life expectancy to aprox. 23.59  in the 90's.
```{r figure3.5}
gapminder %>%
  filter(lifeExp<= 35) %>% 
  arrange(year, lifeExp) %>% 
  ggplot(aes(year, lifeExp, size= pop)) +
    geom_point(aes(color= country, alpha= 0.1))
```

+ Instruction: Make up your own! Between the dplyr coverage in class and the list above, I think you get the idea.

##### The 10 countries with the lowest life expectancy growth. 
```{r}
gapminder %>%
  group_by(country) %>% 
  select(country, year, lifeExp) %>% 
  mutate(lifeExp_growth = lifeExp - first(lifeExp)) %>% 
  arrange(lifeExp_growth) %>% head(10) %>% 
  knitr::kable(format = "markdown", padding=2, caption= "Life expectancy growth")
```

##### The three countries with lowest life expentancy in 2007.
```{r}
gapminder %>%
arrange(lifeExp) %>% 
filter(year== 2007) %>% 
  head(3) %>% knitr::kable()
```

##### Swaziland had the lowest life expectancy in 2007. However, compared to Mozambique and Zambia (the next two countries in the list), its gdp Per capita is high.
```{r figure3.6}
gapminder %>%
  filter(country== "Swaziland" | country== "Mozambique" | country== "Zambia" ) %>% 
  select(country, year, lifeExp, gdpPercap ) %>%
ggplot( aes(year , gdpPercap)) +
    geom_point(aes(size=lifeExp , shape= country, color= country ))+
  stat_smooth(method="lm")
  
```

## Reflection
1_ I need to refresh my knowledge in statistics in order to understand what linear regression, or any regression, means and what it indicates. So far, I have made advance in the aesthetics part (colors, shapes, different types of graphs). I liked the peer reviews because i could see the progress of other people and learn from the way they read data and interpret the results; i still need to work more on that.

2_ It is really fun to explore this dataset, it tells lots of stories. I found a little trouble plotting all the countries at the same time because it is a lots of datapoints and the graphs and labels overlap too much. I find that low alphatransparency helps us seeing the overlaps which is important. 

3_ I tried to write  most of the code using piping but sometimes I used the simple nested functions just to try everything. 

4_ I learned the hard way that <- and = can not be used interchangably to define variables, as I learned in my first R course. They throw different results when used in nested functions.
